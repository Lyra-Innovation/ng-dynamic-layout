<div fxFlex fxLayout="column">
  <ng-container *ngIf="!layoutConfig.children">
    <div
      *ngIf="editingMode"
      class="editing-container"
      fxFlex
      fxLayout="column"
      fxLayoutAlign="start stretch"
    >
      <!-- If layout does not have children and is editing, display the component configuration -->
      <div fxLayout="row" fxLayoutAlign="center center">
        <div fxLayout="row" fxFlex fxLayoutAlign="center center">
          <mat-form-field>
            <mat-label>Component</mat-label>
            <mat-select
              [value]="layoutConfig.component?.type"
              (valueChange)="selectComponent($event)"
            >
              <mat-option></mat-option>
              <mat-option
                *ngFor="let component of (availableComponents$ | async)"
                [value]="component"
              >
                {{ component }}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div>
        <div fxLayout="row" class="toolbar">
          <button
            mat-icon-button
            (click)="splitLayout(false)"
            class="vertical-split"
          >
            <mat-icon>view_agenda</mat-icon>
          </button>
          <button mat-icon-button (click)="splitLayout(true)">
            <mat-icon>view_agenda</mat-icon>
          </button>
          <button mat-icon-button (click)="deleteSelf.emit()">
            <mat-icon>close</mat-icon>
          </button>
        </div>
      </div>

      <div
        *ngIf="layoutConfig.component"
        class="dynamic-container"
        fxFlex
        fxLayoutAlign="center center"
      >
        <dl-component-config
          [pageId]="pageId"
          [componentConfig]="layoutConfig.component"
        ></dl-component-config>
      </div>
    </div>

    <!-- If layout does not have children and is not editing, display the component -->
    <ng-container *ngIf="!editingMode && layoutConfig.component">
      <dl-component-container
        [pageId]="pageId"
        [componentConfig]="layoutConfig.component"
      ></dl-component-container>
    </ng-container>
  </ng-container>

  <ng-container *ngIf="layoutConfig.children">
    <!-- If layout has children and is editing, display the children in
      as-split to let the user change the size of the layout -->
    <as-split
      fxFlex
      *ngIf="editingMode"
      [direction]="layoutConfig.column ? 'vertical' : 'horizontal'"
      (dragEnd)="resizeEnd($event)"
    >
      <as-split-area [size]="layoutConfig.split">
        <dl-dynamic-container
          fxFlex
          [pageId]="pageId"
          [editingMode]="editingMode"
          [layoutConfig]="layoutConfig.children.first"
          (deleteSelf)="deleteChild(true)"
        ></dl-dynamic-container>
      </as-split-area>
      <as-split-area [size]="100 - layoutConfig.split">
        <dl-dynamic-container
          fxFlex
          [pageId]="pageId"
          [editingMode]="editingMode"
          [layoutConfig]="layoutConfig.children.second"
          (deleteSelf)="deleteChild(false)"
        ></dl-dynamic-container>
      </as-split-area>
    </as-split>

    <ng-container *ngIf="!editingMode">
      <!-- If layout has children but is not editing, display normal divs according to the size -->
      <div [fxLayout]="layoutConfig.column ? 'column' : 'row'">
        <div [fxFlex]="layoutConfig.split">
          <dl-dynamic-container
            fxFlex
            [pageId]="pageId"
            [editingMode]="editingMode"
            [layoutConfig]="layoutConfig.children.first"
          ></dl-dynamic-container>
        </div>
        <div [fxFlex]="100 - layoutConfig.split">
          <dl-dynamic-container
            fxFlex
            [editingMode]="editingMode"
            [pageId]="pageId"
            [layoutConfig]="layoutConfig.children.second"
          ></dl-dynamic-container>
        </div>
      </div>
    </ng-container>
  </ng-container>
</div>
